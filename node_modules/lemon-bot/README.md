<h1>ğŸ‹ Lemon-Bot</h1>

ä¸€ä¸ªåŸºäºé…·Qå’ŒCoolQ HTTP APIæ’ä»¶çš„QQæœºå™¨äººNodejså¼€å‘æ¡†æ¶ã€‚

- æ”¯æŒå¤šå‘½ä»¤åŒ¹é…ã€å‘½ä»¤è‡ªå®šä¹‰è§£æ

- ä½¿ç”¨ä¿®é¥°å™¨è¿›è¡Œçµæ´»çš„å‘½ä»¤è§¦å‘æ§åˆ¶

- æ”¯æŒä¼šè¯ä¸Šä¸‹æ–‡åŠŸèƒ½

- æ”¯æŒå¤šæœºå™¨äººè¿è¡Œ

- and more ...

  

## å‰è¨€

è¯¥é¡¹ç›®ä»å¤„äºæ—©æœŸå¼€å‘ç‰ˆï¼Œæ•…ç‰ˆæœ¬å˜åŠ¨è¾ƒä¸ºé¢‘ç¹ï¼Œä½†ä¼šå°½å¯èƒ½ä¿è¯åŸºæœ¬å¼€å‘æ–¹å¼ä¸å˜ï¼Œå…·ä½“å˜åŠ¨è§ [Changelog](https://github.com/XHMM/lemon-bot/blob/master/CHANGELOG.md)

## å‡†å¤‡

1. å®‰è£… [nodejs](https://nodejs.org/en/download/) (è¯¥æ¡†æ¶åŸºäºv10.16.3ç‰ˆæœ¬è¿›è¡Œå¼€å‘ä¸æµ‹è¯•)

2. å®‰è£… é…·Q å’Œ HTTPæ’ä»¶ï¼š

   - Windows: é¦–å…ˆå‰å¾€é…·Qçš„[ç‰ˆæœ¬å‘å¸ƒ](https://cqp.cc/b/news)é¡µé¢ä¸‹è½½ï¼ˆAirä¸ºå…è´¹ç‰ˆï¼ŒProä¸ºæ”¶è´¹ç‰ˆï¼‰ï¼Œä¸‹è½½åè§£å‹å¯åŠ¨ `CAQ.exe` æˆ– `CQP.exe` å¹¶ç™»é™†ä½ çš„QQæœºå™¨äººè´¦å·ã€‚ç„¶åæ ¹æ®[CoolQ HTTP APIæ’ä»¶æ–‡æ¡£](https://cqhttp.cc/docs/)ä¸­çš„"æ‰‹åŠ¨å®‰è£…"éƒ¨åˆ†çš„æ•™ç¨‹è¿›è¡Œæ’ä»¶å®‰è£…ã€‚
   - Linux / Mac: æŸ¥çœ‹[CoolQ HTTP APIæ’ä»¶æ–‡æ¡£](https://cqhttp.cc/docs/)ä¸­çš„"ä½¿ç”¨Docker"éƒ¨åˆ†çš„æ•™ç¨‹è¿›è¡Œå®‰è£…

3. ä¿®æ”¹HTTPæ’ä»¶çš„é…ç½®æ–‡ä»¶: æ¯ä¸ªè´¦å·çš„é…ç½®æ–‡ä»¶å­˜æ”¾è·¯å¾„ä¸€èˆ¬ä¸º `/path/to/é…·Q/data/app/io.github.richardchien.coolqhttpapi/config/QQå·.json` (ä¹Ÿå¯èƒ½æ˜¯ `.ini` æ ¼å¼)ã€‚ä¸‹é¢ä»¥ `.json` æ ¼å¼æ¥è¯´æ˜åœ¨ä½¿ç”¨è¯¥æ¡†æ¶æ—¶å¿…é¡»è¦è¿›è¡Œä¿®æ”¹çš„é…ç½®é¡¹ï¼ˆå…¶ä»–é…ç½®è¯´æ˜å¯è§[æ’ä»¶æ–‡æ¡£](https://cqhttp.cc/docs/#/Configuration?id=é…ç½®é¡¹)ï¼‰ï¼š

   ```metadata json
   {
     "port": 5700, // HTTPæ’ä»¶çš„è¿è¡Œç«¯å£ï¼Œè¯·è‡ªè¡ŒæŒ‡å®š
     "use_http": true, // é¡»è®¾ä¸ºtrue
     "post_url": "http://127.0.0.1:8888/coolq", // è¿™æ˜¯nodeæœåŠ¡å™¨çš„è¿è¡Œåœ°å€ä»¥åŠç›‘å¬çš„è·¯ç”±ï¼Œä½ åªå¯ä»¥ä¿®æ”¹ç«¯å£å·ï¼Œè¯·å‹¿ä¿®æ”¹è·¯ç”±åœ°å€
     "access_token": "", // å¯é€‰ã€‚è‹¥æŒ‡å®šæ­¤å€¼ï¼Œåˆ™ä½¿ç”¨æ¡†æ¶æ—¶ä¹Ÿé¡»é…ç½®
     "secret": "", // å¯é€‰ã€‚è‹¥æŒ‡å®šæ­¤å€¼ï¼Œåˆ™ä½¿ç”¨æ¡†æ¶æ—¶ä¹Ÿé¡»é…ç½®
     "post_message_format": "array" // è¯·å°†è¯¥é€‰é¡¹åŠ¡å¿…è®¾ä¸ºarray
   }
   ```

4. å®‰è£…è¯¥nodeæ¨¡å—ï¼š `npm i lemon-bot`

5. ç”±äºè¯¥æ¡†æ¶ä½¿ç”¨äº† [decorator](https://www.typescriptlang.org/docs/handbook/decorators.html) è¯­æ³•:

   - è‹¥ä½ æ˜¯ä½¿ç”¨ Javascript è¿›è¡Œå¼€å‘ï¼Œåˆ™éœ€è¦[é…ç½®babel](https://babeljs.io/docs/en/babel-plugin-proposal-decorators)ä»¥æ”¯æŒè¯¥ç‰¹æ€§ã€‚

   - è‹¥æ˜¯ä½¿ç”¨ Typescriptï¼Œåˆ™éœ€è¦åœ¨`tsconfig.json`ä¸­å¯ç”¨decoratorï¼š

     ```metadata json
     {
       "compilerOptions": {
         // ...
         "experimentalDecorators": true
       }
     }
     ```

6. è¯¥æ¡†æ¶ä½¿ç”¨ `debug` æ¨¡å—è¿›è¡Œæ—¥å¿—æ‰“å°ã€‚åœ¨å¼€å‘é˜¶æ®µå»ºè®®å¼€å¯æ—¥å¿—è¾“å‡ºæ¥æ–¹ä¾¿è°ƒè¯•å’Œæ’é”™ï¼šè®¾ç½®ç¯å¢ƒå˜é‡  `DEBUG=lemon-bot*` ï¼Œç„¶åè¿è¡Œä¸»ç¨‹åºå³å¯ã€‚

## Demo

åœ¨ `index.ts` æ–‡ä»¶é‡Œå†™å…¥ä¸‹è¿°ä»£ç ï¼š

```js
import { Command, RobotFactory, HttpPlugin } from "lemon-bot";

class SimpleCommand extends Command {
  // å½“æœºå™¨äººæ¥æ”¶åˆ°"æµ‹è¯•"æˆ–æ˜¯"test"æ–‡æœ¬åï¼Œä¼šè§¦å‘è¯¥å‘½ä»¤
  directive() {
    return ["æµ‹è¯•", "test"];
  }

  // å½“æ¶ˆæ¯æ˜¯ç§å‘ç»™æœºå™¨äººæ—¶ï¼Œä¼šä½¿ç”¨userå‡½æ•°è¿›è¡Œå“åº”
  user({ fromUser }) {
    return "ä½ å¥½å‘€" + fromUser;
  }

  // å½“æœºå™¨äººåœ¨QQç¾¤å†…å¹¶æ£€æµ‹åˆ°ä¸Šè¿°æŒ‡ä»¤åï¼Œä¼šä½¿ç”¨groupå‡½æ•°è¿›è¡Œå“åº”
  group({ fromUser, fromGroup }) {
    // è¿”å›å€¼ä¸ºæ•°ç»„æ—¶ï¼Œæœºå™¨äººä¼šè¿ç»­å‘é€å¤šæ¡æ¶ˆæ¯ã€‚
    return ["è§¦å‘ç¾¤æ˜¯" + fromGroup, "è§¦å‘ç”¨æˆ·æ˜¯" + fromUser];
  }
}

const robot = RobotFactory.create({
  port: 8888, // nodeåº”ç”¨çš„è¿è¡Œç«¯å£ã€‚éœ€è¦å’Œæ’ä»¶é…ç½®æ–‡ä»¶çš„post_urlå¯¹åº”
  robot: 1326099664, // æœºå™¨äººQQå·
  httpPlugin: new HttpPlugin("http://localhost:5700"), // ç”¨äºè°ƒç”¨HTTP Plugin API
  commands: [new SimpleCommand()] // è¯¥æœºå™¨äººå¯å¤„ç†çš„å‘½ä»¤
});

robot.start(); // å¯åŠ¨
```

åœ¨è¿è¡Œè¯¥ä»£ç å‰ï¼Œè¯·ç¡®ä¿ï¼š

- é…·Qå’ŒHTTPæ’ä»¶å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¸”ä¸Šè¿°ä»£ç ä¸­çš„ `robot` å€¼ä¸ºå½“å‰ç™»å½•çš„æœºå™¨äººQQ
- å®‰è£…è¦æ±‚ä¿®æ”¹äº†HTTPæ’ä»¶çš„é…ç½®æ–‡ä»¶

ç„¶ååœ¨å‘½ä»¤è¡Œå†…è¾“å…¥ `npx ts-node index.ts` å³å¯å¯åŠ¨æœºå™¨äººã€‚

ä¸€å¯¹ä¸€èŠå¤©æµ‹è¯•ï¼šç”¨ä¸€ä¸ªåŠ äº†æœºå™¨äººä¸ºå¥½å‹çš„QQå·å‘æœºå™¨äººå‘é€ "æµ‹è¯•" æˆ– "test" ï¼Œä¼šå‘ç°æœºå™¨äººè¿”å›äº† "ä½ å¥½å‘€[ä½ çš„QQå·]"ã€‚

ç¾¤èŠæµ‹è¯•ï¼šå°†è¯¥æœºå™¨äººæ‹‰å…¥ç¾¤å†…ï¼Œç„¶ååœ¨ç¾¤å†…å‘é€"æµ‹è¯•"æˆ–"test"ï¼Œä¼šå‘ç°æœºå™¨äººè¿ç»­è¿”å›äº†ä¸¤æ¡æ¶ˆæ¯:  "è§¦å‘ç¾¤æ˜¯[æœºå™¨äººæ‰€åœ¨Qç¾¤]" å’Œ "è§¦å‘ç”¨æˆ·æ˜¯[ä½ çš„QQå·]"ã€‚

## æ¡ˆä¾‹

- [å°å¿ƒæœºå™¨äºº](https://github.com/XHMM/bot-xiaoxin)

## APIæ–‡æ¡£

Tipsï¼šä¸‹è¿°æ¶‰åŠçš„ç±»å‹å®šä¹‰å’Œenumå®šä¹‰å¯ç›´æ¥å‰å¾€æºç å†…æŸ¥çœ‹ï¼Œå¯å¸®åŠ©æ›´å¥½çš„ç†è§£å…¶å«ä¹‰ã€‚

### Class RobotFactory

è¯¥ç±»ç”¨äºæœºå™¨äººçš„åˆ›å»ºã€‚

#### static create(config: CreateParams): CreateReturn

`CreateParams`ï¼šè¯¥å‡½æ•°æ‰€éœ€å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¥å—å¦‚ä¸‹å±æ€§ï¼š

| key        | type       | description                                            | optional |
| ---------- | ---------- | ------------------------------------------------------ | -------- |
| port       | number     | nodeæœåŠ¡å™¨çš„è¿è¡Œç«¯å£                                   |          |
| robot      | number     | æœºå™¨äººQQå·                                             |          |
| httpPlugin | HttpPlugin | HTTPæ’ä»¶å®ä¾‹                                           |          |
| commands   | Command[]  | éœ€è¦æ³¨å†Œçš„å‘½ä»¤                                         |          |
| session    | Session    | ä¼ å…¥è¯¥å‚æ•°è¿è¡Œä½¿ç”¨sessionå‡½æ•°                          | optional |
| secret     | string     | é¡»å’ŒHTTPæ’ä»¶é…ç½®æ–‡ä»¶å€¼ä¿æŒä¸€è‡´ï¼Œç”¨äºå¯¹ä¸ŠæŠ¥æ•°æ®è¿›è¡ŒéªŒè¯ | optional |
| context    | any        | è¯¥å±æ€§ä¼šä½œä¸ºCommandç»§æ‰¿ç±»çš„æˆå‘˜å±æ€§ï¼Œé»˜è®¤å€¼ä¸ºnull      | optional |

`CreateReturn`ï¼šè¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å¦‚ä¸‹å±æ€§

| key   | type              | description |
| ----- | ----------------- | ----------- |
| start | ()=>Promise<void> | å¯åŠ¨æœºå™¨äºº  |
| stop  | () => void        | åœæ­¢æœºå™¨äºº  |

Exampleï¼š

```js
const robot = RobotFactory.create({
  port: 8888,
  robot: 1326099664,
  httpPlugin: new HttpPlugin("http://localhost:5700"),
  commands: [new SimpleCommand()]
});
robot.start();
```



### Class Command

è¯¥ç±»éœ€è¦è¢«ç»§æ‰¿ä½¿ç”¨ï¼Œç”¨æ¥åˆ›å»ºå‘½ä»¤ã€‚ä¸‹é¢å°†ä»¥ç»§æ‰¿ç±»çš„è§’åº¦è¿›è¡Œæè¿°ï¼š

#### ç»§æ‰¿ç±»çš„åŸºæœ¬ç»“æ„ï¼š

```typescript
// å¯¼å…¥åŸºç±»
import { Command} from 'lemon-bot';
// å¯¼å…¥tsç±»å‹å®šä¹‰æå‡å¼€å‘ä½“éªŒ
import { ParseParams, ParseReturn, UserHandlerParams, GroupHandlerParams, SessionHandlerParams, HandlerReturn } from 'lemon-bot'

class MyCommand extends Command<C> {
    context: C;
    httpPlugin;
    
    // ä¸‹é¢çš„[directiveå‡½æ•°]å’Œ[parseå‡½æ•°]å¿…é¡»è‡³å°‘æä¾›ä¸€ä¸ª
    directive(): string[]
    parse(params: ParseParams): ParseReturn

    // ä¸‹é¢çš„ä¸‰ç§å‡½æ•°å¿…é¡»è‡³å°‘æä¾›ä¸€ä¸ª
    user(params: UserHandlerParams): HandlerReturn
    group(params: GroupHandlerParams): HandlerReturn
    both(params: BothHandlerParams): HandlerReturn
    
    // ä¸‹é¢çš„å‡½æ•°éƒ½æ˜¯ä»¥sessionå¼€å¤´ï¼Œå«åš[sessionå‡½æ•°]ï¼Œå¯æä¾›ä»»æ„å¤šä¸ªï¼Œè¯¦è§ä¸‹æ–¹æ–‡æ¡£æè¿°
    sessionA(params: SessionParams): HandlerReturn
    sessionB(params: SessionParams): HandlerReturn
}
```

##### contextå±æ€§

è¯¥å±æ€§çš„å€¼ç­‰åŒäºä½¿ç”¨ `RobotFactory.create` æ—¶ä¼ ç»™ `context `å‚æ•°çš„å†…å®¹ï¼Œé»˜è®¤ä¸ºnullã€‚

##### httpPluginå±æ€§

è¯¥å±æ€§çš„å€¼ä¸ºä½¿ç”¨ `RobotFactory.create` æ—¶ä¼ ç»™ `httpPlugin` å‚æ•°çš„å†…å®¹ã€‚

##### **directive**å‡½æ•°

è¯¥å‡½æ•°åº”è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚å‡å¦‚å®ƒè¿”å›äº† `["å¤©æ°”", "weather"]` ï¼Œå¹¶ä¸”**æ²¡æœ‰**å®šä¹‰ `parseå‡½æ•°` æ—¶ï¼Œå½“æ¥æ”¶åˆ°ç”¨æˆ·æ¶ˆæ¯åï¼Œä¼šåˆ¤æ–­æ¶ˆæ¯å†…å®¹æ˜¯å¦ç­‰äº"å¤©æ°”"æˆ–è€…"weather"ï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™ä¼šæ‰§è¡Œ `userå‡½æ•°` æˆ– `groupå‡½æ•°` æˆ– `bothå‡½æ•°` ï¼Œè‹¥ä¸ç›¸ç­‰ï¼Œåˆ™ä¼šè¿›è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤çš„åˆ¤æ–­ã€‚(è¯¥å‡½æ•°çš„è§¦å‘æ¡ä»¶åŒæ ·ä¼šå—åˆ°ä¸‹è¿°`trigger`ä¿®é¥°å™¨çš„çº¦æŸ)

##### parseå‡½æ•°

ä¸Šè¿°çš„ `directiveå‡½æ•°` æ— æ³•å®ç°è‡ªå®šä¹‰å‘½ä»¤è§£æï¼Œæ¯”å¦‚æƒ³è¦è·å– "å¤©æ°” è¥¿å®‰" è¿™ä¸€æ¶ˆæ¯ä¸­çš„åŸå¸‚ä¿¡æ¯ï¼Œåˆ™éœ€è¦ä½¿ç”¨ `parseå‡½æ•°` æ‰‹åŠ¨å¤„ç†ï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼ä¿¡æ¯å¯åœ¨ `userå‡½æ•°` ã€`groupå‡½æ•°`ã€`bothå‡½æ•°` çš„å‚æ•°ä¸­è®¿é—®ã€‚**æé†’ï¼š**è‹¥æä¾›äº†è¯¥å‡½æ•°ï¼Œåˆ™ä¸ä¼šå†ä½¿ç”¨ `directive` å‡½æ•°è¿›è¡Œå‘½ä»¤å¤„ç†ã€‚

`directiveå‡½æ•°` å’Œ `parseå‡½æ•°` æ˜¯å…è®¸åŒæ—¶å­˜åœ¨çš„ï¼Œå¹¶ä¸”ååˆ†å»ºè®®ä¸è¦çœç•¥ `directiveå‡½æ•°` çš„å£°æ˜ï¼Œå› ä¸ºé€šè¿‡è¯¥å‡½æ•°çš„è¿”å›å€¼å†…å®¹å¯ä»¥æå‡ä»£ç é˜…è¯»æ€§ï¼Œæ–¹ä¾¿è¯†åˆ«è¯¥å‘½ä»¤çš„ç”¨é€”ã€‚

##### userå‡½æ•°

æä¾›è¯¥å‡½æ•°è¡¨ç¤ºå½“å‰å‘½ä»¤æ”¯æŒç”¨æˆ·å’Œæœºå™¨äººç§èŠçš„åœºæ™¯ã€‚

##### groupå‡½æ•°

æä¾›è¯¥å‡½æ•°è¡¨ç¤ºå½“å‰å‘½ä»¤æ”¯æŒç¾¤ç»„èŠå¤©ä¸‹çš„åœºæ™¯ã€‚**æé†’** ï¼šç¾¤ç»„æ¶ˆæ¯åŒ…æ‹¬äº† åŒ¿å å’Œ éåŒ¿å ä¸¤ç§æƒ…å†µï¼Œæ•…è¯¥å‡½æ•°å‚æ•°çš„ `fromUser` å­—æ®µå¯èƒ½ä¸ºQQå·ï¼Œä¹Ÿå¯èƒ½ä¸ºä¸€ä¸ªå¯¹è±¡æè¿°äº†åŒ¿åç”¨æˆ·ä¿¡æ¯ã€‚å¯ä½¿ç”¨è¯¥å‡½æ•°å‚æ•°ä¸­çš„ `messageFromType` åˆ¤æ–­ã€‚

##### bothå‡½æ•°

å½“ä½ çš„å‘½ä»¤å¤„ç†é€»è¾‘åœ¨ç§èŠå’Œç¾¤èŠä¸‹æ¯”è¾ƒç›¸ä¼¼æ—¶ï¼Œè‹¥åŒæ—¶æä¾› `userå‡½æ•°` å’Œ `groupå‡½æ•°` ä¼šå¢åŠ ä»£ç å†—ä½™ï¼Œæ•…è¯¥ `bothå‡½æ•°` å°±æ˜¯ç”¨æ¥åŒæ—¶å¤„ç†æ¥è‡ªç§èŠæˆ–ç¾¤èŠçš„æ¶ˆæ¯ã€‚**æé†’ï¼š**è‹¥æä¾›äº†è¯¥å‡½æ•°ï¼Œåˆ™ `userå‡½æ•°` å’Œ `groupå‡½æ•°` ä¼šæ— æ•ˆã€‚æ­¤å¤–ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ¤æ–­æ¶ˆæ¯æºæ˜¯ç”¨æˆ·æ¶ˆæ¯ã€ç¾¤ç»„éåŒ¿åæ¶ˆæ¯è¿˜æ˜¯ç¾¤ç»„åŒ¿åæ¶ˆæ¯ï¼Œå¯ä½¿ç”¨å‡½æ•°å‚æ•°çš„`messageFromType` å­—æ®µæ¥åˆ¤æ–­ã€‚

##### sessionå‡½æ•°

è¯¥å‡½æ•°çš„åŠŸèƒ½å‚è§ä¸‹æ–¹[sessionå‡½æ•°](#class-session)çš„æè¿°ã€‚

#### å‡½æ•°å‚æ•°è¯´æ˜ï¼š

ä¸Šè¿°å‡½æ•°ä¸­ï¼Œ`directiveå‡½æ•°` æ˜¯æ— å‚çš„ï¼Œå…¶ä½™ç±»å‹çš„å‡½æ•°å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„å±æ€§å†…å®¹å¦‚ä¸‹ï¼ˆscopeåˆ—æè¿°äº†è¯¥å±æ€§å­˜åœ¨äºå“ªäº›å‡½æ•°ï¼Œallè¡¨ç¤ºæ¯ä¸ªå‡½æ•°éƒ½æœ‰è¯¥å‚æ•°ï¼‰ï¼š

| key             | type                                                         | description                                                  | scope                   |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ----------------------- |
| data            | any                                                          | å€¼ä¸º `parse` å‡½æ•°çš„è¿”å›å€¼                                    | user,group,both         |
| message         | Message[]                                                    | ä»¥äºŒç»´æ•°ç»„çš„å½¢å¼è¡¨ç¤ºçš„æ¶ˆæ¯å†…å®¹                               | all                     |
| rawMessage      | string                                                       | ä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºçš„æ¶ˆæ¯å†…å®¹                                   | all                     |
| requestBody     | any                                                          | åŸå§‹httpè¯·æ±‚çš„bodyæ•°æ®ï¼Œå…·ä½“å†…å®¹å¯æŸ¥çœ‹HTTPæ’ä»¶æ–‡æ¡£           | all                     |
| fromUser        | number\| AnonymousUser                                       | å‘é€æ¶ˆæ¯è€…çš„QQï¼Œä¸ºéæ•°å­—æ—¶ä»£è¡¨æ˜¯åŒ¿åç”¨æˆ·                     | all                     |
| fromGroup       | number\|undefined                                            | å‘é€æ¶ˆæ¯è€…æ‰€åœ¨çš„Qç¾¤ï¼Œ`userå‡½æ•°`ä¸­çš„è¯¥å€¼ä¸º `undefined`        | all                     |
| robot           | number                                                       | æ‰§è¡Œè¯¥æŒ‡ä»¤çš„æœºå™¨äºº                                           | all                     |
| isAt            | boolean                                                      | æ˜¯å¦è‰¾ç‰¹äº†æœºå™¨äºº                                             | group                   |
| messageFromType | enum MessageFromType                                         | æ¶ˆæ¯æ¥è‡ªæ–¹ï¼šgroupæŒ‡ç¾¤èŠ, anonymousæŒ‡ç¾¤å†…åŒ¿åèŠ, useræŒ‡ç§èŠ   | user,group,both         |
| setEnd          | () => Promise<void>                                          | æ˜¯ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç”¨æ¥è®¾ç½®ä¼šè¯ä¸Šä¸‹æ–‡ç»“æŸ                         | session                 |
| historyMessage  | Record<string, Array<Message[]>>                             | ä¸€ä¸ªå¯¹è±¡ï¼Œä¿å­˜äº†å†å²ä¼šè¯æ¶ˆæ¯ï¼Œkeyä¸ºåœ¨ `groupå‡½æ•°` æˆ– `userå‡½æ•°` å†…è°ƒç”¨`setNext`æ—¶æŒ‡å®šçš„å‚æ•°åç§° (å«â€˜sessionâ€™å•è¯å‰ç¼€) | session                 |
| setNext         | (sessionName: string, expireSeconds?: number) => Promise<void> | æ˜¯ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç”¨æ¥è®¾ç½®ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„`sessionå‡½æ•°`          | user,group,both,session |

#### å‡½æ•°è¿”å›å€¼ï¼š

##### parseå‡½æ•°

- æ— è¿”å›å€¼æˆ–æ˜¯è¿”å›äº† `undefined`ï¼šè¡¨ç¤ºç”¨æˆ·æ¶ˆæ¯ä¸æ»¡è¶³è¯¥å‘½ä»¤çš„å¤„ç†æ¡ä»¶
- å…¶ä»–ä»»æ„ç±»å‹çš„å€¼ï¼šè¯¥å€¼åœ¨ `userå‡½æ•°` ã€`groupå‡½æ•°`ã€`bothå‡½æ•°` å‚æ•°çš„ `data` å±æ€§ä¸­è®¿é—®åˆ°

##### userå‡½æ•°ã€groupå‡½æ•°ã€sessionå‡½æ•°

- æ— è¿”å›å€¼æˆ–æ˜¯è¿”å›äº†`undefined`ï¼šè¡¨ç¤ºå¤„ç†å®Œæ¯•ï¼Œä½†ä¸è¿”å›ä»»ä½•æ¶ˆæ¯
- `{ atSender:boolean, content: string }`ï¼šä¸ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ`atSender` è¡¨ç¤ºæ˜¯å¦è‰¾ç‰¹å‘é€è€…(ä»…ç¾¤èŠæœ‰æ•ˆ)ï¼Œ`content` ä¸ºå“åº”å†…å®¹
- `string[]`ï¼šè¡¨ç¤ºè¿ç»­å“åº”å¤šæ¡æ¶ˆæ¯
- `string`ï¼šè¡¨ç¤ºå“åº”ä¸€æ¡ä¸è‰¾ç‰¹å‘é€è€…çš„æ¶ˆæ¯



#### è£…é¥°å™¨ï¼š

##### include( number[] )

å¯ç”¨äº `groupå‡½æ•°` å’Œ `userå‡½æ•°`ï¼Œè¡¨ç¤ºåªæœ‰è¿™äº›QQç¾¤/QQå·æ‰å¯ä»¥è§¦å‘è¯¥å‘½ä»¤ï¼š

```js
@include([ 12312, 21223 ])
user() {} //åªæœ‰QQä¸ºä¸ºå®ƒä¿©çš„ç”¨æˆ·å¯è§¦å‘è¯¥å‘½ä»¤

@include([ 3423344 ])
group() {} // åªæœ‰QQç¾¤å·ä¸ºå®ƒçš„ç¾¤å¯è§¦å‘è¯¥å‘½ä»¤
```

##### exclude( number[] )

å¯ç”¨äº `groupå‡½æ•°` å’Œ `userå‡½æ•°`ï¼Œè¡¨ç¤ºè¿™äº›QQç¾¤/QQå·ä¸èƒ½è§¦å‘è¯¥å‘½ä»¤ã€‚**åŒæ—¶ä½¿ç”¨`include`å’Œ`exclude`ä¼šæŠ¥é”™ã€‚**

```js
@exclude([ 12312, 21223 ])
user() {} // é™¤äº†ä¸Šè¿°ä¸¤ä½QQç”¨æˆ·ä¸èƒ½è§¦å‘è¯¥å‘½ä»¤ï¼Œå…¶ä»–ç”¨æˆ·å¯è§¦å‘

@include([ 3333 ])
group() {} // åªæœ‰ç¾¤å·ä¸º3333çš„ç¾¤å¯è§¦å‘è¯¥å‘½ä»¤
```

##### trigger( triggerType )

å¯ç”¨äº `groupå‡½æ•°` å’Œ `userå‡½æ•°`ï¼Œè¡¨ç¤ºå‘½ä»¤è§¦å‘æ–¹å¼ï¼Œå¯èµ‹å€¼ä¸ºï¼š

- `TriggerType.at` ï¼šç”¨æˆ·å¿…é¡»è‰¾ç‰¹æœºå™¨äººå¹¶å‘é€æ¶ˆæ¯æ–¹å¯è§¦å‘å‘½ä»¤
- `TriggerType.noAt`ï¼šç”¨æˆ·ä¹‹é—´åœ¨ç¾¤å†…å‘é€æ¶ˆæ¯å¯è§¦å‘å‘½ä»¤ï¼Œè‰¾ç‰¹æœºå™¨äººå³ä½¿å‘½ä»¤æ­£ç¡®ä¹Ÿä¸ä¼šè§¦å‘
- `TriggerType.both`  (é»˜è®¤å€¼)ï¼šè‰¾ç‰¹æˆ–è€…ä¸è‰¾ç‰¹æœºå™¨äººéƒ½å¯è§¦å‘å‘½ä»¤

```js
@trigger(TriggerType.noAt)
group() {}
```

##### scope( triggerScope )

å¯ç”¨äº `groupå‡½æ•°` å’Œ `userå‡½æ•°`ï¼Œè¡¨ç¤ºä»€ä¹ˆèº«ä»½çš„ç”¨æˆ·å¯è§¦å‘è¯¥å‘½ä»¤ï¼Œå¯èµ‹å€¼ä¸ºï¼š

- `TriggerScope.all` (é»˜è®¤å€¼)ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½å¯è§¦å‘
- `TriggerScope.owner`ï¼šä»…ç¾¤ä¸»å¯è§¦å‘
- `TriggerScope.admin`ï¼šä»…ç®¡ç†å‘˜å¯è§¦å‘
- `TriggerScope.member`ï¼šä»…æ™®é€šæˆå‘˜å¯è§¦å‘
- ä½¿ç”¨æˆ–è¿ç®—`|`äº§ç”Ÿç»„åˆå€¼ï¼šæ¯”å¦‚ `TriggerScope.owner | TriggerScope.admin` è¡¨ç¤ºç¾¤ä¸»å’Œç®¡ç†å‘˜å¯è§¦å‘

```js
@trigger(TriggerScope.all)
group() {}
```



### Class CQMessageHelper

ä¸€ä¸ªç”¨æ¥å¤„ç†æ•°ç»„æ ¼å¼æ¶ˆæ¯çš„å·¥å…·ç±»ï¼Œè¯¥æ–¹æ³•æ¥æ”¶çš„ `message` å‚æ•°å³ä¸º `userå‡½æ•°` ã€`groupå‡½æ•°`ã€`bothå‡½æ•°` ã€`sessionå‡½æ•°` å‚æ•°çš„ `message` å±æ€§ã€‚

##### static removeAt(message: Message[]): Message[]

ç§»é™¤æ¶ˆæ¯æ•°ç»„çš„è‰¾ç‰¹è¯­å¥

##### static isAt(robotQQ: number, message: Message[]): boolean

åˆ¤æ–­æ¶ˆæ¯æ•°ç»„æ˜¯å¦å«æœ‰è‰¾ç‰¹robotQQçš„è¯­å¥

##### static toRawMessage(message: Message[], removeAt?: boolean): string

å°†æ¶ˆæ¯æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œç‰¹æ®Šå½¢å¼çš„ä¿¡æ¯åˆ™ä¼šå˜æˆ[CQç ](https://docs.cqp.im/manual/cqcode/)å½¢å¼ã€‚

### Class CQRawMessageHelper

ä¸€ä¸ªç”¨æ¥å­—ç¬¦ä¸²æ ¼å¼æ¶ˆæ¯çš„å·¥å…·ç±»ã€‚è¯¥æ–¹æ³•æ¥æ”¶çš„ `message` å‚æ•°å³ä¸º `userå‡½æ•°` ã€`groupå‡½æ•°`ã€`bothå‡½æ•°` ã€`sessionå‡½æ•°` å‚æ•°çš„ `rawMessage` å±æ€§ã€‚

##### static removeAt(message: string): string

ç§»é™¤å­—ç¬¦ä¸²æ¶ˆæ¯ä¸­çš„è‰¾ç‰¹CQç 



### Class HttpPlugin

è¯¥ç±»ç”¨äºä¸»åŠ¨è°ƒç”¨[HTTPæ’ä»¶æä¾›çš„API](https://cqhttp.cc/docs/#/API?id=api-åˆ—è¡¨)ã€‚

#### constructor(endpoint: string, config?: PluginConfig)

| key      | type         | description        | optional |
| -------- | ------------ | ------------------ | -------- |
| endpoint | string       | HTTPæ’ä»¶çš„è¿è¡Œåœ°å€ |          |
| config   | PluginConfig | æ’ä»¶é…ç½®ä¿¡æ¯       | optional |

`PluginConfig`ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å¦‚ä¸‹å±æ€§

| key         | type   | description                                                | optional |
| ----------- | ------ | ---------------------------------------------------------- | -------- |
| accessToken | string | é¡»å’ŒHTTPæ’ä»¶é…ç½®æ–‡ä»¶å€¼ä¿æŒä¸€è‡´ã€‚åœ¨è°ƒç”¨APIæ—¶ä¼šéªŒè¯è¯¥tokenã€‚ | optional |

è¯¥ç±»æä¾›çš„å®ä¾‹æ–¹æ³•åç§°æ˜¯[HTTPæ’ä»¶æ–‡æ¡£](https://cqhttp.cc/docs/#/API?id=api-åˆ—è¡¨)æä¾›APIçš„ **é©¼å³°å¼å‘½å**ï¼Œæ–¹æ³•çš„è¿”å›å€¼ä¸€ä¸ªpromiseï¼Œå…¶resolveå€¼ç­‰åŒäºHTTPæ’ä»¶æ–‡æ¡£çš„jsonå¯¹è±¡ï¼Œä½†æ–¹æ³•çš„å‚æ•°ç±»å‹è¯·ä»¥ä¸‹è¿°æ–‡æ¡£ä¸ºå‡†ã€‚

ç›®å‰æä¾›äº†å¦‚ä¸‹æ¥å£çš„å®ç°ï¼š

##### sendPrivateMsg(personQQ: number, message: string, escape?: boolean)

##### sendGroupMsg(groupQQ: number, message: string, escape?: boolean)

##### sendMsg(numbers: { user?: number;  group?: number; }, message: string, escape?: boolean)

##### getGroupList()

##### getGroupMemberList(groupQQ: number)

##### downloadImage(cqFile: string)



### Class Session

è¯¥ç±»ç”¨äºå¯ç”¨ä¸Šä¸‹æ–‡åŠŸèƒ½ã€‚

#### constructor(options? any)

è¯¥æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹åŒ [ioredis]( https://github.com/luin/ioredis/blob/master/API.md#Redis ) åº“çš„`Redis` æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œexampleï¼š

```js
import { RobotFactory, HttpPlugin, Session } from 'lemon-bot';

const robot = RobotFactory.create({
  // ...
  session: new Session(6379)
});
```

#### å¦‚ä½•å¯ç”¨ä¸Šä¸‹æ–‡åŠŸèƒ½ï¼Ÿ

é€šè¿‡åœ¨ `create` å‡½æ•°é‡Œä¼ å…¥ `session` å‚æ•°(å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤º)ï¼Œå³å¯å¼€å¯ä½¿ç”¨`sessionå‡½æ•°`/ä¸Šä¸‹æ–‡åŠŸèƒ½ã€‚

#### ä»€ä¹ˆæ˜¯sessionå‡½æ•°ï¼Ÿ

`sessionå‡½æ•°` æŒ‡çš„æ˜¯ä»¥"session"å•è¯å¼€å¤´çš„å†™åœ¨Commandç»§æ‰¿ç±»é‡Œçš„å‡½æ•°ï¼Œç»§æ‰¿ç±»é‡Œå¯ä»¥æœ‰ä»»æ„å¤šä¸ª `sessionå‡½æ•°`ã€‚åœ¨ `sessionå‡½æ•°` æœªè¿‡æœŸå‰ï¼Œæ¥ä¸‹æ¥å‘ç»™æœºå™¨äººçš„æ¶ˆæ¯å³ä½¿æ»¡è¶³äº†å…¶ä»–å‘½ä»¤çš„å¤„ç†æ¡ä»¶ï¼Œä½†å¹¶ä¸ä¼šæ‰§è¡Œä»–ä»¬ï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œ `sessionå‡½æ•°`ä¸­çš„é€»è¾‘ï¼Œç›´åˆ°sessionè¿‡æœŸæˆ–è°ƒç”¨ `setEnd` æ‰‹åŠ¨ç»“æŸã€‚

#### å¦‚ä½•ä½¿ç”¨sessionå‡½æ•°ï¼Ÿ

åœ¨ `userå‡½æ•°` æˆ– `groupå‡½æ•°` çš„å‚æ•°ä¸­æœ‰ä¸ª `setNext` å±æ€§ï¼Œåœ¨ `sessionå‡½æ•°` çš„å‚æ•°ä¸­æœ‰ `setNext` å’Œ `setEnd` è¿™ä¸¤ä¸ªå±æ€§ï¼Œä»–ä»¬éƒ½æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œé€šè¿‡è°ƒç”¨å®ƒä»¬å³å¯è§¦å‘ä¸Šä¸‹æ–‡åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯å‡½æ•°è¯´æ˜ï¼š

- `setNext(name: string, expireSeconds?: number): Promise<void>` ï¼š`name`çš„å€¼ä¸ºå…¶ä»– `sessionå‡½æ•°` çš„å‡½æ•°åæˆ–æ˜¯çœç•¥"session"å•è¯åçš„éƒ¨åˆ† (**è­¦å‘Šï¼š** `name` æ˜¯å¤§å°å†™æ•æ„Ÿçš„)ï¼Œ`expireSeconds` é€‰å¡«ï¼Œè¡¨ç¤ºä¼šè¯è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ä¸º5åˆ†é’Ÿã€‚

  è°ƒç”¨ `setNext` åï¼Œå½“æœºå™¨äººå†æ¬¡æ¥å—åˆ°è¯¥ç”¨æˆ·ä¼šè¯åï¼Œå°†ç›´æ¥æ‰§è¡Œ `setNext` å‚æ•°æŒ‡å®šçš„å‡½æ•°ã€‚ç„¶åä½ å¯ä»¥ç»§ç»­è°ƒç”¨ `setNext` æŒ‡å®šå…¶ä»–å‡½æ•°ï¼Œæ¯æ¬¡æ‰§è¡Œ `sessionå‡½æ•°` æ—¶ï¼Œéƒ½å¯ä»¥è·å–åˆ°å†å²æ¶ˆæ¯è®°å½•ï¼Œä»è€Œè¿›è¡Œè‡ªå·±çš„é€»è¾‘å¤„ç†ã€‚

- `setEnd(): Promise<void>` ï¼š

  è°ƒç”¨è¯¥å‡½æ•°è¡¨ç¤ºç»“æŸå½“å‰ä¼šè¯ä¸Šä¸‹æ–‡ï¼Œå½“æœºå™¨äººå†æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†ä¼šæŒ‰ç…§å¸¸è§„çš„è§£ææµç¨‹å¤„ç†ï¼šå³å…ˆåˆ¤æ–­ `directiveå‡½æ•°` çš„è¿”å›å€¼æˆ–è€…æ˜¯æ‰§è¡Œ `parseå‡½æ•°`ï¼Œç„¶åæ‰§è¡Œ `groupå‡½æ•°` æˆ– `userå‡½æ•°` ã€‚**è­¦å‘Šï¼š** è¯·åˆ«å¿˜è®°è°ƒç”¨è¯¥å‡½æ•°æ¥ç»ˆæ­¢ä¼šè¯ï¼Œå¦åˆ™åœ¨sessionè¿‡æœŸå‰å°†ä¼šä¸€ç›´æ‰§è¡Œæœ¬æ¬¡çš„sessionå‡½æ•°ã€‚

#### sessionå‡½æ•°demoï¼š

ç°åœ¨æˆ‘ä»¬æ”¹é€ ä¸Šé¢Demoéƒ¨åˆ†ä¸­çš„ä»£ç ï¼Œæ¥æ¼”ç¤º `sessionå‡½æ•°` çš„ä½¿ç”¨ï¼Œ

**è­¦å‘Šï¼š** ä¸‹è¿°ä¾‹å­è®¾ç½®äº†`count` å®ä¾‹å±æ€§ï¼Œç”±äºä¸åŒçš„HTTPè¯·æ±‚ä¼šå…±äº«å‘½ä»¤ï¼Œä»¥åŠå¯èƒ½çš„å¹¶å‘ç­‰åŸå› ï¼Œæ— æ³•ç¡®ä¿`count` å±æ€§çš„å€¼ä¸é¢„æœŸä¸€è‡´ï¼Œæ•…å¼ºçƒˆä¸å»ºè®®åœ¨ç±»ä¸­è®¾ç½®å®ä¾‹å±æ€§ï¼Œå…±äº«å±æ€§å¯ä½¿ç”¨ç¬¬ä¸‰æ–¹å­˜å‚¨å¦‚ `redis` æ¥è¿›è¡Œä¿å­˜ã€‚ä¸‹è¿°ä»£ç ä»…ä¸ºæ¼”ç¤ºsessionå‡½æ•°çš„ä½¿ç”¨ï¼š

```js
import { Command, RobotFactory, HttpPlugin, Session } from "lemon-bot";

class SimpleCommand extends Command {
  count = 3;

  directive() {
    return ["æµ‹è¯•", "test"];
  }

  async user({ fromUser, setNext }) {
    await setNext('A');
    return "user run with " + this.count;
  }

  async sessionA({ setNext }) {
    this.count--;
    await setNext("B", 10);
    return "sessionA run with " + this.count;
  }

  async sessionB({ setNext }) {
    this.count--;
    await setNext("sessionC");
    return "sessionB run with " + this.count;
  }

  async sessionC({ setNext, setEnd }) {
    this.count--;
    await setEnd();
    return "sessionC run with ç»“æŸ";
  }
}

const robot = RobotFactory.create({
  port: 8888,
  robot: 834679887,
  httpPlugin: new HttpPlugin("http://localhost:5700"),
  commands: [new SimpleCommand()],
  session: new Session()
});

robot.start();
```

è¿è¡Œä¸Šè¿°ä»£ç å‰ï¼Œè¯·ç¡®ä¿ ï¼š

- rediså¤„äºè¿è¡ŒçŠ¶æ€å¹¶å¯è®¿é—®å…¶é»˜è®¤çš„6379ç«¯å£
- `robot`å­—æ®µä¸ºä½ å½“å‰é…·Qç™»é™†çš„è´¦å·

ç„¶ååœ¨å‘½ä»¤è¡Œå†…è¾“å…¥ `npx ts-node index.ts` å¯åŠ¨æœºå™¨äººï¼Œç„¶åå¼€å§‹å‘ä½ çš„æœºå™¨äººå‘é€ä¸‹é¢çš„ä¿¡æ¯ï¼š

- å‘é€ "æµ‹è¯•"ï¼šä¼šæ‰§è¡Œ `userå‡½æ•°` ï¼Œè¿”å› "user run with 3"
- å‘é€ ä»»æ„æ¶ˆæ¯ï¼šä¼šæ‰§è¡Œ `sessionA`ï¼Œè¿”å›"sessionA run with 2"
- 10så†…å‘é€ä»»æ„æ¶ˆæ¯ï¼šä¼šæ‰§è¡Œ `sessionB`ï¼Œè¿”å›"sessionB run with 1"
- å‘é€ ä»»æ„æ¶ˆæ¯ï¼šä¼šæ‰§è¡Œ `sessionC`ï¼Œè¿”å›"sessionC run with ç»“æŸ"
- å‘é€ "æµ‹è¯•"ï¼šå°†é‡æ–°ä» `userå‡½æ•°`å¼€å§‹è§£æï¼Œè¿”å› "user run with 0"

## å®‰å…¨æŒ‡å—

1. å°½å¯èƒ½é¿å…HTTPæ’ä»¶çš„ä¸ŠæŠ¥åœ°å€(å³nodeæœåŠ¡å™¨åœ°å€)å¯è¢«å¤–ç½‘è®¿é—®ï¼Œè¿™ä¼šå¯¼è‡´æ”¶åˆ°æ¶æ„è¯·æ±‚ã€‚
2. å°½å¯èƒ½é¿å…HTTPæ’ä»¶çš„è¿è¡Œåœ°å€å¯è¢«å…¬ç½‘è®¿é—®ï¼Œè¿™ä¼šå¯¼è‡´æ”»å‡»è€…å¯è¿›è¡ŒAPIè°ƒç”¨ã€‚è‹¥å¿…éœ€è¦å…¬ç½‘ä¸‹å¯è®¿é—®ï¼Œåˆ™åº”åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® access_token ï¼Œç„¶ååœ¨ä»£ç çš„ `HttpPlugin` å®ä¾‹ä¸­ä¼ å…¥ `accessToken`å‚æ•°ï¼Œè®¾ç½®åï¼Œå½“åœ¨è°ƒç”¨APIæ—¶ä¼šè‡ªåŠ¨éªŒè¯tokenå€¼ã€‚



## Recipes

### 1. æ–‡ä»¶ç›®å½•å¦‚ä½•ç»„ç»‡ï¼Ÿ

å»ºè®®ä½¿ç”¨å¦‚ä¸‹ç»“æ„ï¼š

```
+-- commands  
|   +-- SearchQuestionCommand.ts  
|   +-- HelpCommand.ts      
|   +-- WordCommand.ts  
+-- index.ts
```

### 2. å¦‚ä½•æä¾›ä¸€ä¸ªé»˜è®¤çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼Ÿ

å‡å¦‚æˆ‘ä»¬ç›®å‰çš„ `commands` æ•°ç»„æ˜¯ `[ new ACommand(), new BCommand() ]`ï¼Œç°åœ¨æˆ‘å¸Œæœ›å½“ç”¨æˆ·å‘æ¥çš„æ¶ˆæ¯éƒ½ä¸æ»¡è¶³è¿™äº›å‘½ä»¤çš„è§£ææ¡ä»¶æ—¶ï¼Œå°†å®ƒäº¤ç”±ä¸€ä¸ªé»˜è®¤çš„å¤„ç†å‘½ä»¤ï¼š

1. å®ç°ä¸€ä¸ªè¿”å›å€¼å§‹ç»ˆä¸º **é`undefined`** çš„`parse`å‡½æ•°ï¼š

   ```js
   export default class DefaultCommand extends Command {
       parse() {return true;}
       user(){
           return "é»˜è®¤è¿”å›"
       }
   }
   ```

2. å°†è¯¥ç±»çš„å®ä¾‹å¯¹è±¡æ”¾åœ¨ `commands` æ•°ç»„çš„**æœ€åä¸€ä½** ï¼š

   ```js
   const robot = new RobotFactory.create({
       // ...
       commands: [new ACommand(), new BCommand(), new DefaultCommand()]
   })
   ```

### 3. å¦‚ä½•å®ç°ç¾¤ç»„ä¸‹ä¸åŒæˆå‘˜å…±äº«sessionå‡½æ•°ï¼Ÿ

æ¯”å¦‚æˆ‘æƒ³å®ç°è¿™æ ·ä¸€ä¸ªå‘½ä»¤: å½“æˆ‘è‰¾ç‰¹æœºå™¨äººå›å¤"å¼€å§‹æ”¶é›†åé¦ˆ"åï¼Œæ¥ä¸‹æ¥ç¾¤å‘˜çš„å‘è¨€å†…å®¹ä¼šå…¨éƒ¨è¢«é‡‡é›†ï¼Œç›´åˆ°æˆ‘è‰¾ç‰¹æœºå™¨äººå‘é€ "æ”¶é›†ç»“æŸ"ã€‚

ç­”: ç›®å‰çš„ `sessionå‡½æ•°` çš„è§¦å‘æ¡ä»¶å¿…é¡»æ˜¯ "æ¶ˆæ¯æ˜¯åŒä¸€ç”¨æˆ·å‘é€ï¼Œå¦‚æœç”¨æˆ·ä½äºç¾¤å†…ï¼Œå¿…é¡»æ˜¯åœ¨åŒä¸€ä¸ªç¾¤å†…å‘é€æ¶ˆæ¯"ï¼Œç›®å‰æš‚ä¸æ”¯æŒè§¦å‘æ¡ä»¶æ˜¯ "æ¶ˆæ¯å¯ä»¥æ¥è‡ªåŒä¸€ç¾¤ç»„çš„ä¸åŒç”¨æˆ·"çš„æƒ…å†µã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ä½¿ç”¨rediså¹¶åœ¨é»˜è®¤æ¶ˆæ¯å¤„ç†å‘½ä»¤é‡Œè¿›è¡Œåˆ¤æ–­æ˜¯å¦å¤„äº"æ¶ˆæ¯åé¦ˆ"çŠ¶æ€ä¸‹å¹¶è¿›è¡Œå¤„ç†ã€‚



## TODO

- [ ] å®Œå–„APIæ¥å£å®ç°
- [ ] æ·»åŠ éæ¶ˆæ¯äº‹ä»¶ä¸ŠæŠ¥çš„å¤„ç†
- [ ] ç¼–å†™æµ‹è¯•ğŸ˜«
- [ ] ä½¿ç”¨æ–‡æ¡£å·¥å…·ç”Ÿæˆæ›´æ˜“é˜…è¯»çš„æ–‡æ¡£